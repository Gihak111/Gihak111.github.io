<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ì–‘ì´ vs ê°•ì•„ì§€ AI ë¶„ë¥˜ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .subtitle {
            color: #666;
            font-size: 1rem;
        }
        
        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .status-box {
            padding: 15px;
            background-color: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .status-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 5px;
        }
        
        .status-text {
            color: #1d4ed8;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: #f9fafb;
        }
        
        .image-preview {
            margin-top: 15px;
        }
        
        .preview-image {
            max-width: 300px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        
        .result-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .result-output {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: monospace;
            color: #374151;
        }
        
        .info-card {
            background-color: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 20px;
            border-radius: 8px;
        }
        
        .info-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #065f46;
            margin-bottom: 10px;
        }
        
        .info-text {
            color: #047857;
        }
        
        .labels-card {
            background-color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
        }
        
        .labels-list {
            list-style: disc;
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .labels-list li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>"ì…ë ¥ ì‚¬ì§„ì´ ê³ ì–‘ì´ì¸ì§€ ê°•ì•„ì§€ì¸ì§€ êµ¬ë¶„í•´ì£¼ëŠ” AI" AI ëª¨ë¸</h1>
            <p class="subtitle">ë°ì´í„° íƒ€ì…: image</p>
        </header>

        <div class="card">
            <h2 class="section-title">ëª¨ë¸ í…ŒìŠ¤íŠ¸</h2>
            
            <div class="status-box">
                <h3 class="status-title">ëª¨ë¸ ìƒíƒœ</h3>
                <p id="model-load-status" class="status-text">ëª¨ë¸ ë¡œë“œ ëŒ€ê¸° ì¤‘...</p>
            </div>

            <div class="form-group">
                <label for="test-image-upload">í…ŒìŠ¤íŠ¸í•  ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”:</label>
                <input type="file" id="test-image-upload" accept="image/*">
                <div id="image-preview" class="image-preview" style="display: none;">
                    <img id="preview-image" class="preview-image" alt="Image Preview">
                </div>
            </div>

            <div class="button-group">
                <button id="test-predict-btn" class="btn btn-primary" disabled>ì˜ˆì¸¡ ì‹¤í–‰</button>
                <button id="clear-test-data-btn" class="btn btn-secondary">ì…ë ¥ ì´ˆê¸°í™”</button>
            </div>

            <div class="result-section">
                <h3>ì˜ˆì¸¡ ê²°ê³¼:</h3>
                <pre id="test-output-result" class="result-output">ì´ê³³ì— ì˜ˆì¸¡ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</pre>
            </div>
        </div>

        <div class="info-card">
            <h3 class="info-title">Hugging Face ëª¨ë¸ ì •ë³´:</h3>
            <p class="info-text">
                ì´ ëª¨ë¸ì€ Hugging Face ì €ì¥ì†Œ (gihakkk/v0_test)ì—ì„œ ë¡œë“œë˜ëŠ” MobileNet ê¸°ë°˜ì˜ íŒŒì¸íŠœë‹ëœ ë¶„ë¥˜ê¸°ì…ë‹ˆë‹¤.
                ê³ ì–‘ì´ì™€ ê°•ì•„ì§€ ì´ë¯¸ì§€ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </div>

        <div class="labels-card">
            <h3 class="section-title">í•™ìŠµëœ ë¼ë²¨ ëª©ë¡:</h3>
            <ul class="labels-list">
                <li>ê³ ì–‘ì´ (cat)</li>
                <li>ê°•ì•„ì§€ (dog)</li>
            </ul>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let classifierModel = null;
        let featureExtractor = null;
        let testImageFile = null;
        let testImagePreviewUrl = null;
        let isPredicting = false;

        const labels = ["cat", "dog"];
        const modelLoadStatus = document.getElementById('model-load-status');
        const testPredictBtn = document.getElementById('test-predict-btn');
        const clearTestDataBtn = document.getElementById('clear-test-data-btn');
        const testOutputResult = document.getElementById('test-output-result');
        const imageUpload = document.getElementById('test-image-upload');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');

        /**
         * ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ íŒŒì¼ì„ Image ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
         */
        const loadImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };

        /**
         * ëª¨ë“  ëª¨ë¸ì„ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
         */
        const loadAllModels = async () => {
            try {
                modelLoadStatus.textContent = "AI ëª¨ë¸ ë¡œë”© ì¤‘... (ìµœì´ˆ 1íšŒ ì‹¤í–‰)";

                await tf.ready();

                // 1. í•™ìŠµëœ 'ë¶„ë¥˜ê¸°' ëª¨ë¸ ë¡œë“œ (ì‚¬ìš©ìê°€ ì œê³µí•œ ì •í™•í•œ íŒŒì¼ëª… ì‚¬ìš©)
                const modelUrl = "https://huggingface.co/gihakkk/v0_test/resolve/main/tfjs-classifier-ì…ë ¥_ì‚¬ì§„ì´_ê³ ì–‘ì´ì¸ì§€_ê°•ì•„ì§€ì¸ì§€_êµ¬ë¶„í•´ì£¼ëŠ”_AI_MobileNet-Finetuned-Classifier.json";
                classifierModel = await tf.loadLayersModel(modelUrl);
                console.log("âœ… ë¶„ë¥˜ê¸° ëª¨ë¸ ë¡œë“œ ì™„ë£Œ.");

                // 2. MobileNetV2 íŠ¹ì§• ì¶”ì¶œê¸° ë² ì´ìŠ¤ ëª¨ë¸ ë¡œë“œ
                const MOBILENET_URL = "https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v2_100_224/feature_vector/3/default/1";
                featureExtractor = await tf.loadGraphModel(MOBILENET_URL, { fromTFHub: true });
                console.log("âœ… MobileNetV2 ë¡œë“œ ì™„ë£Œ.");

                modelLoadStatus.textContent = "ğŸ‰ ëª¨ë“  ëª¨ë¸ ë¡œë“œ ì™„ë£Œ! ì˜ˆì¸¡ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                testPredictBtn.disabled = false;
            } catch (e) {
                console.error("ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨:", e);
                modelLoadStatus.textContent = `ì˜¤ë¥˜: ëª¨ë¸ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (${e.message})`;
            }
        };

        /**
         * ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
         */
        const handleTestImageUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
                testImageFile = file;
                if (testImagePreviewUrl) {
                    URL.revokeObjectURL(testImagePreviewUrl);
                }
                testImagePreviewUrl = URL.createObjectURL(file);
                previewImage.src = testImagePreviewUrl;
                imagePreview.style.display = 'block';
            } else {
                clearTestImage();
            }
        };

        /**
         * í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì´ˆê¸°í™”
         */
        const clearTestImage = () => {
            if (testImagePreviewUrl) {
                URL.revokeObjectURL(testImagePreviewUrl);
            }
            testImageFile = null;
            testImagePreviewUrl = null;
            imageUpload.value = "";
            imagePreview.style.display = 'none';
        };

        /**
         * í…ŒìŠ¤íŠ¸ ë°ì´í„° ì „ì²´ ì´ˆê¸°í™”
         */
        const handleClearTestData = () => {
            clearTestImage();
            testOutputResult.textContent = "ì´ê³³ì— ì˜ˆì¸¡ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
        };

        /**
         * ì˜ˆì¸¡ ì‹¤í–‰
         */
        const handleTestPrediction = async () => {
            if (!classifierModel || !featureExtractor) {
                testOutputResult.textContent = "ì˜¤ë¥˜: ëª¨ë¸ì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                return;
            }

            if (!testImageFile) {
                testOutputResult.textContent = "ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.";
                return;
            }

            isPredicting = true;
            testPredictBtn.disabled = true;
            testPredictBtn.textContent = "ì˜ˆì¸¡ ì¤‘...";
            testOutputResult.textContent = "ì˜ˆì¸¡ ì¤‘...";

            try {
                const img = await loadImage(testImageFile);

                const result = tf.tidy(() => {
                    const MODEL_IMAGE_SIZE = 224;
                    let imageTensor = tf.browser
                        .fromPixels(img)
                        .resizeNearestNeighbor([MODEL_IMAGE_SIZE, MODEL_IMAGE_SIZE])
                        .toFloat()
                        .div(tf.scalar(255));
                    
                    if (imageTensor.shape[2] === 4) {
                        imageTensor = imageTensor.slice([0, 0, 0], [MODEL_IMAGE_SIZE, MODEL_IMAGE_SIZE, 3]);
                    }
                    
                    const batchedImage = imageTensor.expandDims(0);
                    const embedding = featureExtractor.predict(batchedImage);
                    const prediction = classifierModel.predict(embedding);
                    return prediction.dataSync();
                });

                const probabilities = Array.from(result);
                const predictedClassIndex = probabilities.indexOf(Math.max(...probabilities));
                const predictionLabel = labels[predictedClassIndex] || "ì•Œ ìˆ˜ ì—†ìŒ";
                const predictionProb = (probabilities[predictedClassIndex] * 100).toFixed(2);

                let resultText = `ì˜ˆì¸¡ ê²°ê³¼: ${predictionLabel === "cat" ? "ê³ ì–‘ì´" : "ê°•ì•„ì§€"} (${predictionProb}%)`;
                const probMap = labels
                    .map((label, i) => `  "${label === "cat" ? "ê³ ì–‘ì´" : "ê°•ì•„ì§€"}": ${(probabilities[i] * 100).toFixed(2)}%`)
                    .join(",\n");
                resultText += `\n\n- ì „ì²´ í™•ë¥ ë¶„í¬ -\n{\n${probMap}\n}`;

                testOutputResult.textContent = resultText;
            } catch (e) {
                console.error("ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                testOutputResult.textContent = "ì˜¤ë¥˜: ì˜ˆì¸¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. " + e.message;
            } finally {
                isPredicting = false;
                testPredictBtn.disabled = false;
                testPredictBtn.textContent = "ì˜ˆì¸¡ ì‹¤í–‰";
            }
        };

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        imageUpload.addEventListener('change', handleTestImageUpload);
        testPredictBtn.addEventListener('click', handleTestPrediction);
        clearTestDataBtn.addEventListener('click', handleClearTestData);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë¸ ë¡œë“œ ì‹œì‘
        window.addEventListener('load', loadAllModels);
    </script>
</body>
</html>
